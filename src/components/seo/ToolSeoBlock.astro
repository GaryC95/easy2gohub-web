---
import AdsSlot from "../ads/AdsSlot.astro";

type Faq = { q: string; a: string };
type Seo = {
  intro?: string;
  steps?: string[];
  tips?: string[];
  faq?: Faq[];
};

const {
  title,
  seo,
  showAds = true,
  adsProfile = "default", // "light" | "default" | "heavy"
} = Astro.props as {
  title: string;
  seo?: Seo;
  showAds?: boolean;
  adsProfile?: "light" | "default" | "heavy";
};

const intro = seo?.intro ?? "";
const steps = seo?.steps ?? ["Select your file(s).", "Adjust settings (if available).", "Download the result."];
const tips = seo?.tips ?? [
  "Everything runs locally in your browser (no upload).",
  "For photos use JPG/WEBP/AVIF; for sharp edges use PNG.",
  "Smaller dimensions usually reduce size more than quality alone.",
];
const faq = seo?.faq ?? [];

const isLight = adsProfile === "light";
const isHeavy = adsProfile === "heavy";
---

<section class="tool-card p-8 md:p-10 space-y-10">
  <header class="space-y-2">
    <h2 class="text-xl md:text-2xl font-extrabold text-slate-900 tracking-tight">How it works</h2>
    {intro ? <p class="text-sm md:text-base text-slate-600 leading-relaxed">{intro}</p> : null}
  </header>

  <div class="grid lg:grid-cols-12 gap-8 items-start">
    <div class="lg:col-span-7 space-y-4">
      <ol class="list-decimal pl-6 text-sm md:text-base text-slate-600 space-y-2">
        {steps.map((s) => <li>{s}</li>)}
      </ol>

      {showAds && !isLight ? <div class="pt-3"><AdsSlot label="Sponsored" variant="banner" /></div> : null}

      <div class="pt-2">
        <h3 class="text-sm md:text-base font-extrabold text-slate-900">Tips</h3>
        <ul class="mt-3 text-sm md:text-base text-slate-600 space-y-2 list-disc pl-6">
          {tips.map((t) => <li>{t}</li>)}
        </ul>
      </div>

      {showAds && isHeavy ? <div class="pt-3"><AdsSlot label="Sponsored" /></div> : null}
    </div>

    <aside class="lg:col-span-5 space-y-4">
      <div class="tool-card p-6 bg-white/60 border border-white/40">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-extrabold text-slate-900">About this tool</h3>
          <span class="material-symbols-outlined text-slate-400">info</span>
        </div>
        <p class="mt-3 text-sm text-slate-600 leading-relaxed">
          <span class="font-extrabold">{title}</span> is designed for fast everyday tasks with a clean UX and privacy-first local processing.
        </p>
      </div>

      {showAds && (isHeavy || (!isLight && tips.length)) ? <AdsSlot label="Sponsored" variant="banner" /> : null}

      {faq.length ? (
        <div class="tool-card p-6 bg-white/60 border border-white/40">
          <h3 class="text-sm font-extrabold text-slate-900 mb-3">FAQ</h3>
          <div class="space-y-3">
            {faq.map((f) => (
              <details class="rounded-xl bg-white/60 border border-white/50 p-4">
                <summary class="cursor-pointer font-extrabold text-slate-900">{f.q}</summary>
                <p class="mt-2 text-sm text-slate-600 leading-relaxed">{f.a}</p>
              </details>
            ))}
          </div>
        </div>
      ) : null}

      {showAds && isHeavy ? <AdsSlot label="Sponsored" variant="banner" /> : null}
    </aside>
  </div>
</section>
