---
import { CATEGORY_ORDER, CATEGORY_META, getToolsByCategory } from "../../data/tools";

const path = Astro.url.pathname;

const isActive = (href: string) => {
  if (href === "/") return path === "/";
  return path === href || path.startsWith(href);
};

const caret = "chevron_right";
---

<aside class="w-72 glass-sidebar flex flex-col overflow-y-auto">
  <div class="p-6 border-b border-white/40">
    <a href="/" class="flex items-center gap-3 group">
      <div class="size-9 rounded-xl bg-gradient-to-br from-primary to-accent text-white flex items-center justify-center shadow-lg shadow-primary/20">
        <span class="material-symbols-outlined text-xl">hub</span>
      </div>
      <div class="leading-tight">
        <div class="text-base font-extrabold text-slate-900 tracking-tight">
          Easy2Go<span class="text-primary">Hub</span>
        </div>
        <div class="text-[10px] font-bold uppercase tracking-[0.18em] text-slate-400">Tool Suite</div>
      </div>
    </a>
  </div>

  <nav class="p-5 space-y-5">
    <div>
      <p class="text-[11px] uppercase font-extrabold tracking-[0.18em] text-slate-400 px-1 mb-3">Navigation</p>
      <div class="space-y-2">
        <a
          href="/"
          class={`flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-extrabold transition ${
            isActive("/") ? "bg-primary/10 text-primary ring-1 ring-primary/10" : "text-slate-700 hover:bg-white/60 hover:text-primary"
          }`}
        >
          <span class="material-symbols-outlined text-lg">home</span>
          Home
        </a>

        <a
          href="/tools/"
          class={`flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-extrabold transition ${
            isActive("/tools/") ? "bg-primary/10 text-primary ring-1 ring-primary/10" : "text-slate-700 hover:bg-white/60 hover:text-primary"
          }`}
        >
          <span class="material-symbols-outlined text-lg">apps</span>
          All Tools
        </a>
      </div>
    </div>

    <div class="space-y-2">
      <p class="text-[11px] uppercase font-extrabold tracking-[0.18em] text-slate-400 px-1">Explorer</p>

      <div class="space-y-2">
        {CATEGORY_ORDER.map((cat) => {
          const meta = CATEGORY_META[cat];
          const list = getToolsByCategory(cat);

          return (
            <details class="group rounded-2xl bg-white/40 border border-white/50 overflow-hidden" open={path.startsWith(`/${cat}/`)}>
              <summary class="flex items-center gap-3 px-4 py-3 cursor-pointer select-none list-none">
                <span class="material-symbols-outlined text-lg text-slate-400 group-open:rotate-90 transition-transform">{caret}</span>
                <span class={`material-symbols-outlined text-lg ${meta.iconClass}`}>{meta.icon}</span>

                <div class="flex-1">
                  <div class="text-sm font-extrabold text-slate-900">{meta.label}</div>
                  <div class="text-[10px] font-bold uppercase tracking-[0.18em] text-slate-400">{list.length} tools</div>
                </div>
              </summary>

              <div class="px-2 pb-3">
                <div class="ml-9 pl-3 border-l-2 border-slate-100 space-y-1">
                  {list
                    .slice()
                    .sort((a, b) => (a.order ?? 999) - (b.order ?? 999))
                    .map((t) => {
                      const href = `/${t.category}/${t.slug}/`;
                      const active = isActive(href);
                      return (
                        <a
                          href={href}
                          class={`flex items-center gap-2.5 px-3 py-2 rounded-r-xl text-sm font-extrabold transition ${
                            active ? "text-primary bg-primary/10" : "text-slate-600 hover:bg-white/60 hover:text-primary"
                          }`}
                        >
                          <span class="material-symbols-outlined text-[18px] text-slate-400">{t.icon}</span>
                          <span class="truncate">{t.title}</span>
                        </a>
                      );
                    })}
                </div>
              </div>
            </details>
          );
        })}
      </div>
    </div>
  </nav>

  <div class="p-6 mt-auto">
    <div class="rounded-2xl p-5 bg-primary/5 border border-primary/10">
      <p class="text-xs font-extrabold text-primary mb-1">PRO (Coming Soon)</p>
      <p class="text-xs text-slate-500 leading-relaxed">Batch processing, higher limits, and advanced presets.</p>
      <a href="/tools/" class="inline-flex items-center gap-2 mt-4 text-xs font-extrabold text-primary hover:underline">
        Explore tools <span class="material-symbols-outlined text-sm">arrow_right_alt</span>
      </a>
    </div>
  </div>
</aside>
