---
// src/pages/[category]/[slug].astro
import ToolLayout from "../../layouts/ToolLayout.astro";
import ToolSeoBlock from "../../components/seo/ToolSeoBlock.astro";
import { tools, CATEGORY_ORDER } from "../../data/tools";

// ===== Tool components (add new tool component imports here) =====
import ImageCompressor from "../../components/tools/ImageCompressor.astro";

// ===== Settings components (by settingsType) =====
import ImageSettings from "../../components/settings/ImageSettings.astro";
import PdfSettings from "../../components/settings/PdfSettings.astro";
import TextSettings from "../../components/settings/TextSettings.astro";
import FileSettings from "../../components/settings/FileSettings.astro";
import DevSettings from "../../components/settings/DevSettings.astro";
import ConvertSettings from "../../components/settings/ConvertSettings.astro";
import MediaSettings from "../../components/settings/MediaSettings.astro";

// ===== Component Maps =====
const TOOL_COMPONENTS: Record<string, any> = {
  "image-compressor": ImageCompressor,
  // add more:
  // "image-resizer": ImageResizer,
  // "pdf-merge": PdfMerge,
};

const SETTINGS_COMPONENTS: Record<string, any> = {
  image: ImageSettings,
  pdf: PdfSettings,
  text: TextSettings,
  file: FileSettings,
  dev: DevSettings,
  convert: ConvertSettings,
  media: MediaSettings,
};

export async function getStaticPaths() {
  return tools.map((t) => ({
    params: { category: t.category, slug: t.slug },
  }));
}

const { category, slug } = Astro.params;

const tool = tools.find((t) => t.category === category && t.slug === slug);
if (!tool) throw new Error("Tool not found");

const ToolComponent = TOOL_COMPONENTS[tool.slug] ?? null;

const settingsType = tool.settingsType ?? "none";
const SettingsComponent =
  settingsType !== "none" ? (SETTINGS_COMPONENTS[settingsType] ?? null) : null;

const canonical = `https://www.easy2gohub.com/${tool.category}/${tool.slug}/`;
const adsProfile = tool.adsProfile ?? "default";
---

<ToolLayout
  title={tool.title}
  description={tool.description}
  canonical={canonical}
  adsProfile={adsProfile}
>
  {ToolComponent ? (
    <ToolComponent />
  ) : (
    <div class="tool-card p-10">
      <h2 class="text-xl font-extrabold text-slate-900">Tool coming soon</h2>
      <p class="text-slate-500 mt-2">
        This tool page is wired. Add a component in <span class="font-mono">src/components/tools</span> and map it in
        <span class="font-mono"> TOOL_COMPONENTS</span>.
      </p>
    </div>
  )}

  {SettingsComponent ? (
    <div slot="settings">
      <SettingsComponent tool={tool} />
    </div>
  ) : null}

  <ToolSeoBlock title={tool.title} seo={tool.seo} adsProfile={adsProfile} showAds={adsProfile !== "none"} />
</ToolLayout>
