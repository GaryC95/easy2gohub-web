---
import ToolLayout from "../../layouts/ToolLayout.astro";
import ToolSeoBlock from "../../components/seo/ToolSeoBlock.astro";
import { tools } from "../../data/tools";

// ===== Tools =====
import ImageCompressor from "../../components/tools/ImageCompressor.astro";
import ImageResizer from "../../components/tools/ImageResizer.astro";
import ImageConverter from "../../components/tools/ImageConverter.astro";
import ImageToWebp from "../../components/tools/ImageToWebp.astro";
import ToolPlaceholder from "../../components/tools/ToolPlaceholder.astro";

// ===== Settings =====
import ImageSettings from "../../components/settings/ImageSettings.astro";
import PdfSettings from "../../components/settings/PdfSettings.astro";
import TextSettings from "../../components/settings/TextSettings.astro";
import FileSettings from "../../components/settings/FileSettings.astro";
import DevSettings from "../../components/settings/DevSettings.astro";
import ConvertSettings from "../../components/settings/ConvertSettings.astro";
import MediaSettings from "../../components/settings/MediaSettings.astro";

const TOOL_COMPONENTS = {
  "image-compressor": ImageCompressor,
  "image-resizer": ImageResizer,
  "image-converter": ImageConverter,
  "image-to-webp": ImageToWebp,
};

const SETTINGS_COMPONENTS = {
  image: ImageSettings,
  pdf: PdfSettings,
  text: TextSettings,
  file: FileSettings,
  dev: DevSettings,
  convert: ConvertSettings,
  media: MediaSettings,
};

export async function getStaticPaths() {
  return tools.map(t => ({
    params: { category: t.category, slug: t.slug }
  }));
}

const { category, slug } = Astro.params;
const tool = tools.find(t => t.category === category && t.slug === slug);

const ToolComponent = tool ? TOOL_COMPONENTS[tool.slug] ?? ToolPlaceholder : ToolPlaceholder;
const SettingsComponent = tool && tool.settingsType !== "none"
  ? SETTINGS_COMPONENTS[tool.settingsType] ?? null
  : null;
---

<ToolLayout
  title={tool?.title ?? "Tool"}
  description={tool?.description ?? ""}
  canonical={`https://www.easy2gohub.com/${category}/${slug}/`}
  adsProfile={tool?.adsProfile ?? "default"}
>
  <ToolComponent />

  {SettingsComponent ? (
    <div slot="settings">
      <SettingsComponent tool={tool} />
    </div>
  ) : null}

  <ToolSeoBlock title={tool?.title} seo={tool?.seo} adsProfile={tool?.adsProfile} />
</ToolLayout>
